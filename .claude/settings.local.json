{
  "permissions": {
    "allow": [
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(git log:*)",
      "WebFetch(domain:blog.fsck.com)",
      "WebFetch(domain:github.com)",
      "WebFetch(domain:raw.githubusercontent.com)",
      "WebFetch(domain:api.github.com)",
      "Bash(git checkout:*)",
      "Bash(chmod:*)",
      "Bash(gh issue create --repo liauw-media/CodeAssist --title \"üöÄ Feature: Hybrid Enforcement System (v3.1.1) - Revolutionary Skills Framework\" --body \"$(cat <<''EOF''\n# üéØ Hybrid Enforcement System - v3.1.1\n\n## üìã Overview\n\nCodeAssist v3.1.1 introduces a **revolutionary 4-Tier Hybrid Enforcement System** that solves the critical problem of skills framework \"getting lost\" over time.\n\n**Key Innovation**: System-enforced blocking hooks that **don''t rely on AI agent memory**.\n\n---\n\n## üî¥ The Problem\n\n**Observed Issues** (user feedback):\n- ‚úÖ Brainstorming works well\n- ‚ùå Code gets created without proper review\n- ‚ùå Tests are skipped or not run\n- ‚ùå Commits happen without verification\n- ‚ùå Skills usage differs across projects\n- ‚ùå Skills framework \"gets lost\" during extended sessions\n\n**Root Cause**: Relying on AI agent memory and discipline is unreliable.\n\n---\n\n## ‚úÖ The Solution: 4-Tier Hybrid System\n\n### Tier 1: Skills Decision Tree (Always Loaded - 200 tokens)\n\n**File**: `.claude/SKILLS-DECISION-TREE.md`\n\nPattern matching for automatic skill detection:\n- Contains `migrate|test|seed` ‚Üí üõë BLOCK ‚Üí database-backup (MANDATORY)\n- Tool used: `Edit|Write` ‚Üí üõë BLOCK ‚Üí code-review (MANDATORY after ANY code)\n- User says: `done|commit` ‚Üí üõë BLOCK ‚Üí verification-before-completion (MANDATORY)\n- Contains: `bug|error` ‚Üí systematic-debugging\n- Contains: `new feature` ‚Üí brainstorming ‚Üí writing-plans\n\n**Token cost**: 200 (always in context, never re-read)\n\n### Tier 2: Blocking Hooks (System Enforced - 0 tokens)\n\n**Game Changer**: These are **BASH SCRIPTS** that physically block operations!\n\n#### `hooks/pre-database-operation.sh`\n```bash\n$ php artisan migrate\n\nüõë ============================================ üõë\n   DATABASE OPERATION DETECTED - BLOCKED\nüõë ============================================ üõë\n\n‚ö†Ô∏è  MANDATORY: database-backup skill REQUIRED\n\n‚úÖ Required Actions:\n1. Create backup NOW: ./scripts/backup-database.sh\n2. Use safety wrapper: ./scripts/safe-migrate.sh php artisan migrate\n3. Override (DANGEROUS): export SKIP_BACKUP_CHECK=1\n\nüî¥ AUTHORITY: Based on 2 production database wipes\n   - 2024-03: Tests wiped production (6 months data lost)\n   - 2024-07: migrate:fresh wiped staging (4 hours recovery)\n\nüíæ Production data is IRREPLACEABLE. You only get ONE chance.\n\nüõë OPERATION BLOCKED\n```\n\n#### `hooks/post-code-write.sh`\n```bash\nüìù CODE MODIFIED: src/file.php\n   (Edit #3 since last review)\n\nüõë ============================================ üõë\n   CODE REVIEW REQUIRED - BLOCKING\nüõë ============================================ üõë\n\n‚ö†Ô∏è  You''ve made 3 code changes without review\n\nüìñ MANDATORY: Use code-review skill NOW\n   .claude/skills/core/code-review/SKILL.md\n\nüî¥ AUTHORITY: 60% of bugs caught during code review\n   Skipping review = shipping bugs\n\nBLOCKED: Cannot proceed\n```\n\n#### `hooks/pre-commit-check.sh`\n```bash\n$ git commit -m \"fix stuff\"\n\nüõë ============================================ üõë\n   PRE-COMMIT VERIFICATION - BLOCKING\nüõë ============================================ üõë\n\nüìã Checkpoint 1: Code Review\n‚ùå NO code review found\nMANDATORY: Use code-review skill first\n\nüìã Checkpoint 2: Verification\n‚ùå NO verification found\nMANDATORY: Use verification-before-completion skill\n\nüìã Checkpoint 3: Tests Status\n‚ö†Ô∏è  No test results found\nDid you run tests?\n\nüõë OPERATION BLOCKED\n   Complete verification first, then retry\n```\n\n#### `hooks/periodic-reminder.sh`\n```bash\n‚ö†Ô∏è  =============================================== ‚ö†Ô∏è\n    SKILLS FRAMEWORK CHECK (#10)\n‚ö†Ô∏è  =============================================== ‚ö†Ô∏è\n\nUltra-Compact Checklist:\n\n‚ñ° USE (not skip)\n‚ñ° READ (not remember)\n‚ñ° ANNOUNCE\n‚ñ° WORKFLOW: brainstorm‚Üíplan‚Üíexecute‚ÜíREVIEW‚Üíverify‚Üícommit\n‚ñ° CONSISTENT (same across all projects)\n\nCRITICAL:\n  Did I REVIEW code after writing?\n  Did I VERIFY before commit?\n\nLast reminder: Request #10\nNext reminder: Request #20\n```\n\n**Token cost**: 0 (hook output, not context)  \n**Reliability**: 100% (system enforced, not agent memory)\n\n### Tier 3: Periodic Reminders (Ultra-Compact - 50 tokens)\n\nEvery 10 requests, ultra-compact checklist:\n```\n‚ö†Ô∏è SKILLS CHECK:\n‚ñ° USE ‚ñ° READ ‚ñ° ANNOUNCE\n‚ñ° WORKFLOW: brainstorm‚Üíplan‚Üíexecute‚ÜíREVIEW‚Üíverify‚Üícommit\n‚ñ° CONSISTENT\n\nCRITICAL: REVIEW after code? VERIFY before commit?\n```\n\n**Token cost**: 50 (was 200+ in verbose version)  \n**Frequency**: Every 10 requests (via hook)\n\n### Tier 4: Context Injection (Strategic - 3500 tokens when justified)\n\nOnly inject full skill content when:\n- Database operation detected ‚Üí Read full `database-backup` skill (3500 tokens - justified)\n- 3+ edits without review ‚Üí Read full `code-review` skill (4000 tokens - justified)\n- Commit without verification ‚Üí Read full `verification-before-completion` skill (3000 tokens - justified)\n\n**Token cost**: 3500 √ó 2-3 per session = ~10,000 tokens  \n**When**: Only at critical safety moments\n\n---\n\n## üí∞ Token Efficiency\n\n| Approach | Tokens per 100 Requests | Efficiency |\n|----------|------------------------|------------|\n| **Previous** (re-read every 10) | 100,000+ | ‚ùå Wasteful |\n| **Hybrid** (intelligent) | ~10,700 | ‚úÖ **90% savings** |\n\n**Breakdown per 100 requests:**\n- Decision tree (always loaded): 200 tokens\n- Periodic reminders (10x @ 50): 500 tokens\n- Critical injections (2-3x @ 3500): ~10,000 tokens\n- **Total**: ~10,700 tokens\n\n**Previous approach**: Re-reading full skills every 10 requests = 100,000+ tokens wasted\n\n**Savings**: 90% reduction, 10x more efficient\n\n---\n\n## üéõÔ∏è User-Configurable Token Budgets\n\n**File**: `.claude/settings.json`\n\n```json\n{\n  \"skills\": {\n    \"tokenBudget\": {\n      \"active\": \"balanced\"  // Change to: unlimited, balanced, efficient, minimal\n    }\n  }\n}\n```\n\n### Presets\n\n**1. Unlimited** (Quality First)\n- Max tokens: No limit\n- Periodic reminders: Every 10 requests\n- Critical skills: Full read\n- Best quality, highest cost\n\n**2. Balanced** (Recommended - DEFAULT ‚≠ê)\n- Max tokens: ~20K per 100 requests\n- Periodic reminders: Every 10 requests\n- Critical skills: Full read\n- 90% quality at 10% cost\n\n**3. Efficient** (Token Conscious)\n- Max tokens: ~10K per 100 requests\n- Periodic reminders: Every 20 requests\n- Critical skills: Checklist only (no full reads)\n- Good quality, minimal cost\n\n**4. Minimal** (Ultra-Light)\n- Max tokens: ~5K per 100 requests\n- Periodic reminders: Disabled\n- Critical skills: Checklist only\n- Decision tree only, ultra-minimal cost\n\n---\n\n## üì¶ Installation\n\n### One-Command Install\n\n```bash\n# Direct execution\ncurl -fsSL https://raw.githubusercontent.com/liauw-media/CodeAssist/main/scripts/install-hooks.sh | bash\n\n# Or download and run\ncurl -O https://raw.githubusercontent.com/liauw-media/CodeAssist/main/scripts/install-hooks.sh\nchmod +x install-hooks.sh\n./install-hooks.sh\n```\n\n### What Gets Installed\n\n```\n‚úÖ Skills Decision Tree (.claude/SKILLS-DECISION-TREE.md)\n‚úÖ Settings Configuration (.claude/settings.json)\n‚úÖ 4 Enforcement Hooks (hooks/*.sh)\n   ‚Ä¢ pre-database-operation.sh\n   ‚Ä¢ post-code-write.sh\n   ‚Ä¢ pre-commit-check.sh\n   ‚Ä¢ periodic-reminder.sh\n‚úÖ Hooks Configuration (.claude/hooks.json)\n‚úÖ Tracking Directory (.claude/)\n\nüéØ Enforcement Mode: HYBRID (Blocking)\nToken Budget: Balanced (~20K/100 requests)\n```\n\n### Installation Output\n\n```\n============================================\nCodeAssist Skills Framework Hooks Installer\nVersion 3.1.1 - Hybrid Enforcement\n============================================\n\nüìã Step 1: Installing Skills Decision Tree (Always Loaded)\n   Token cost: ~200 tokens (always in context)\n   ‚úÖ Installed: .claude/SKILLS-DECISION-TREE.md\n\n‚öôÔ∏è  Step 2: Installing Settings Configuration\n   ‚úÖ Installed: .claude/settings.json\n\nü™ù Step 3: Installing Enforcement Hooks\n   ‚úÖ Installed: hooks/pre-database-operation.sh\n   ‚úÖ Installed: hooks/post-code-write.sh\n   ‚úÖ Installed: hooks/pre-commit-check.sh\n   ‚úÖ Installed: hooks/periodic-reminder.sh\n\n‚úÖ All hooks installed!\n\nüõ°Ô∏è Blocking Enforcement Enabled For:\n   üõë Database operations (migrate/test/seed) without backup\n   üõë Commits without code-review + verification\n   üõë 3+ code edits without review\n\n‚ú® Hooks are now active! Skills framework will enforce automatically.\n```\n\n---\n\n## üß™ Testing the System\n\n### Test 1: Database Operation Blocking\n\n```bash\n# Try to migrate without backup (should BLOCK)\nphp artisan migrate\n\n# Expected output:\n# üõë DATABASE OPERATION DETECTED - BLOCKED\n# ‚ö†Ô∏è  MANDATORY: database-backup skill REQUIRED\n# Create backup NOW: ./scripts/backup-database.sh\n```\n\n### Test 2: Code Review Blocking\n\n```bash\n# Edit a file 3 times without review\necho \"test1\" >> src/test.php\necho \"test2\" >> src/test.php\necho \"test3\" >> src/test.php\n\n# Expected output on 3rd edit:\n# üõë CODE REVIEW REQUIRED - BLOCKING\n# ‚ö†Ô∏è  You''ve made 3 code changes without review\n# MANDATORY: Use code-review skill NOW\n```\n\n### Test 3: Commit Blocking\n\n```bash\n# Try to commit without review/verification\ngit add .\ngit commit -m \"test\"\n\n# Expected output:\n# üõë PRE-COMMIT VERIFICATION - BLOCKING\n# ‚ùå NO code review found\n# ‚ùå NO verification found\n# BLOCKED: Cannot commit\n```\n\n### Test 4: Periodic Reminder\n\n```bash\n# After 10 requests, automatic reminder:\n# ‚ö†Ô∏è SKILLS FRAMEWORK CHECK (#10)\n# ‚ñ° USE ‚ñ° READ ‚ñ° ANNOUNCE\n# ‚ñ° WORKFLOW: brainstorm‚Üíplan‚Üíexecute‚ÜíREVIEW‚Üíverify‚Üícommit\n# CRITICAL: REVIEW after code? VERIFY before commit?\n```\n\n---\n\n## üéØ Why This is Revolutionary\n\n### Before Hybrid (Passive)\n\n‚ùå **Relying on AI memory**:\n- \"Remember to use code-review after writing code\"\n- \"Remember to backup before database operations\"\n- \"Remember to verify before commits\"\n\n‚ùå **Problems**:\n- AI forgets during long sessions\n- Skills usage \"gets lost\"\n- Inconsistent across projects\n- 100,000+ tokens wasted per session\n\n### After Hybrid (Active)\n\n‚úÖ **System-enforced blocking**:\n- Physically blocks `php artisan migrate` without backup\n- Physically blocks commits without verification\n- Physically blocks after 3 edits without review\n\n‚úÖ **Benefits**:\n- **Cannot forget** - system enforces\n- **Cannot skip** - operations blocked\n- **Consistent** - works the same everywhere\n- **Efficient** - 90% token reduction\n\n---\n\n## üìä Real-World Impact\n\n### Authority: Based on Production Incidents\n\n**2024-03: Production Database Wipe**\n- Tests ran against production database\n- 6 months of data lost\n- IRREPLACEABLE\n- **Cause**: No backup, no safety check\n- **Prevention**: `pre-database-operation.sh` hook BLOCKS this now\n\n**2024-07: Staging Database Wipe**\n- `migrate:fresh` wiped staging\n- 4 hours recovery time\n- **Cause**: No backup check\n- **Prevention**: Hook blocks until backup confirmed\n\n**Ongoing: Code Review Consistently Skipped**\n- User feedback: \"Brainstorming works well but code never gets completely reviewed\"\n- 60% of bugs caught during code review\n- **Cause**: Relying on AI memory to review\n- **Prevention**: Hook blocks after 3 edits without review\n\n---\n\n## üìñ Documentation\n\n### Core Documents\n\n- **Enforcement Guide**: [docs/SKILLS-ENFORCEMENT.md](https://github.com/liauw-media/CodeAssist/blob/main/docs/SKILLS-ENFORCEMENT.md)\n- **Skills Index**: [skills/README.md](https://github.com/liauw-media/CodeAssist/blob/main/skills/README.md)\n- **Decision Tree**: [.claude/SKILLS-DECISION-TREE.md](https://github.com/liauw-media/CodeAssist/blob/main/.claude/SKILLS-DECISION-TREE.md)\n- **CHANGELOG**: [CHANGELOG.md](https://github.com/liauw-media/CodeAssist/blob/main/CHANGELOG.md)\n\n### Hook Files\n\n- [hooks/pre-database-operation.sh](https://github.com/liauw-media/CodeAssist/blob/main/hooks/pre-database-operation.sh)\n- [hooks/post-code-write.sh](https://github.com/liauw-media/CodeAssist/blob/main/hooks/post-code-write.sh)\n- [hooks/pre-commit-check.sh](https://github.com/liauw-media/CodeAssist/blob/main/hooks/pre-commit-check.sh)\n- [hooks/periodic-reminder.sh](https://github.com/liauw-media/CodeAssist/blob/main/hooks/periodic-reminder.sh)\n\n### Installation\n\n- [scripts/install-hooks.sh](https://github.com/liauw-media/CodeAssist/blob/main/scripts/install-hooks.sh)\n\n---\n\n## üîß Configuration\n\n### Change Token Budget\n\nEdit `.claude/settings.json`:\n\n```json\n{\n  \"skills\": {\n    \"tokenBudget\": {\n      \"active\": \"efficient\"  // Changed from \"balanced\" to \"efficient\"\n    }\n  }\n}\n```\n\n### Disable Specific Hook\n\nEdit `.claude/settings.json`:\n\n```json\n{\n  \"skills\": {\n    \"hooks\": {\n      \"available\": {\n        \"post-code-write\": {\n          \"enabled\": false  // Disable code-write reminder\n        }\n      }\n    }\n  }\n}\n```\n\n### Adjust Blocking Thresholds\n\nEdit `.claude/settings.json`:\n\n```json\n{\n  \"skills\": {\n    \"enforcement\": {\n      \"blocking\": {\n        \"codeReview\": {\n          \"blockAfterEdits\": 5,  // Changed from 3 to 5\n          \"remindAfterEdits\": 2\n        }\n      }\n    }\n  }\n}\n```\n\n---\n\n## üí° FAQ\n\n### Q: Do the hooks work with Claude Code CLI?\n**A**: Yes! Designed specifically for Claude Code CLI. Hooks are standard bash scripts.\n\n### Q: Can I use this without hooks?\n**A**: Yes. Set `\"hooks\": { \"enabled\": false }` in settings. You''ll still get decision tree + periodic reminders (less enforcement but still helpful).\n\n### Q: What if I want NO token limits?\n**A**: Set `\"active\": \"unlimited\"` in token budget. Full skills will be read whenever needed.\n\n### Q: Can I override blocking in emergencies?\n**A**: Yes. For database ops: `export SKIP_BACKUP_CHECK=1`. For commits: `git commit --no-verify`. Use sparingly!\n\n### Q: Does this work on Windows?\n**A**: Hooks require bash (Git Bash, WSL, or MSYS2 on Windows). Decision tree + reminders work everywhere.\n\n### Q: Will this slow down my workflow?\n**A**: No! Hooks execute in <100ms. Token budget is 90% smaller. Net result: FASTER workflow with better quality.\n\n---\n\n## üéâ Conclusion\n\nThe Hybrid Enforcement System represents a **paradigm shift** in how AI coding assistants maintain discipline:\n\n**Old way**: \"Please remember to review code\"  \n**New way**: System physically blocks until review done\n\n**Old way**: 100,000+ tokens of repeated reminders  \n**New way**: 10,700 tokens of intelligent enforcement\n\n**Old way**: Skills \"get lost\" during sessions  \n**New way**: System enforces automatically\n\nThis is **v3.1.1** - a revolutionary improvement to the CodeAssist skills framework.\n\n---\n\n## üöÄ Try It Today\n\n```bash\n# Install in any project\ncurl -fsSL https://raw.githubusercontent.com/liauw-media/CodeAssist/main/scripts/install-hooks.sh | bash\n\n# Test database blocking\nphp artisan migrate\n# ‚Üí Will block until backup created!\n\n# Configure token budget\nvim .claude/settings.json\n# ‚Üí Choose: unlimited, balanced, efficient, or minimal\n\n# Enjoy automatic enforcement!\n```\n\n**Feedback**: Report issues or suggest improvements in this repository''s issues.\n\n**Attribution**: Built on [Superpowers](https://github.com/obra/superpowers) by Jesse Vincent ([@obra](https://github.com/obra))\n\n**Repository**: https://github.com/liauw-media/CodeAssist  \n**Version**: 3.1.1  \n**Date**: 2025-11-08\nEOF\n)\")",
      "Bash(gh issue create:*)",
      "Bash(gh:*)",
      "Bash(glab --version:*)",
      "Bash(winget upgrade:*)",
      "WebFetch(domain:cursor.directory)",
      "Bash(npx:*)",
      "Bash(echo:*)",
      "WebSearch",
      "WebFetch(domain:mcpcat.io)",
      "Bash(curl:*)",
      "WebFetch(domain:website.claude.com)",
      "Bash(ls:*)",
      "Bash(xargs:*)",
      "Bash(git rebase:*)"
    ],
    "deny": [],
    "ask": []
  }
}
