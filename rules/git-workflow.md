# Git Workflow Rules

**These rules are ALWAYS enforced. No exceptions.**

## Critical Rules

```
╔═══════════════════════════════════════════════════════════════╗
║  1. NEVER push directly to main or master                     ║
║  2. NEVER include "Co-Authored-By: Claude" in commits         ║
║  3. ALWAYS use feature branch → staging → main flow           ║
║  4. ALWAYS require PR review before merge                     ║
╚═══════════════════════════════════════════════════════════════╝
```

## Branch Flow

```
feature/123-task  →  staging  →  main
       ↓               ↓          ↓
   Development      Testing    Production
```

**Required flow:**
1. Create feature branch from `staging` (or `main` if no staging)
2. Develop and test on feature branch
3. PR to `staging` - requires review
4. Test on staging environment
5. PR from `staging` to `main` - requires review
6. Deploy to production

## Branch Discipline

- **NEVER** commit directly to `main` or `master`
- **NEVER** commit directly to `staging`
- **ALWAYS** create feature branches: `feature/123-description`
- **ONE branch** per issue/feature
- **SMALL commits** - atomic, focused changes

## Branch Naming

```
feature/123-add-user-auth     # New feature
fix/456-login-timeout         # Bug fix
refactor/789-extract-service  # Code improvement
docs/update-readme            # Documentation
hotfix/critical-security-fix  # Emergency fix
```

## Commit Messages

Format: `type: description`

```
feat: add user authentication
fix: resolve login timeout issue
refactor: extract payment service
docs: update API documentation
test: add user registration tests
chore: update dependencies
```

**Rules:**
- Lowercase, no period at end
- Imperative mood: "add" not "added"
- Under 72 characters
- Reference issue: `fix: resolve timeout (#456)`

**FORBIDDEN in commits:**
```
❌ Co-Authored-By: Claude
❌ Co-Authored-By: Claude <noreply@anthropic.com>
❌ Generated by Claude
❌ AI-generated
❌ Any AI attribution
```

Use `/gitsetup` to install a git hook that automatically strips these.

## Before Every Commit

```bash
# Pre-commit checklist
✓ Tests pass
✓ No debug code (console.log, dd(), var_dump)
✓ No hardcoded secrets
✓ No commented-out code
✓ Code is formatted
✓ No unrelated changes
```

## Pull Request Rules

- **Descriptive title** matching branch purpose
- **Link to issue** if applicable
- **Small PRs** - under 400 lines changed
- **Self-review** before requesting review
- **All checks pass** before merge

## NEVER Do

```bash
# ❌ NEVER
git push --force origin main
git commit --amend  # on shared branches
git rebase main     # on shared branches (merge instead)
git reset --hard    # without understanding consequences
```

## ALWAYS Do

```bash
# ✅ ALWAYS
git pull --rebase origin main  # before pushing feature branch
git status                      # before committing
git diff                        # review changes
git branch -d feature/done      # clean up merged branches
```

## Handling Conflicts

1. **Pull latest** from target branch
2. **Resolve** conflicts carefully
3. **Test** after resolution
4. **Never** blindly accept "mine" or "theirs"
